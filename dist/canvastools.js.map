{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 0df0a4435c26247707fe","webpack:///./src/js/closet.js","webpack:///./src/js/template.js","webpack:///./src/js/utils.js","webpack:///./src/scss/canvastools.scss","webpack:///./src/js/main.js"],"names":["window","Element","prototype","closest","s","matches","document","ownerDocument","querySelectorAll","i","el","length","item","parentElement","ButtonsMap","rect","panel","name","ellipse","brush","arrow","mosaic","font","rubber","undo","save","ColorList","FontSize","StrokeWidth","getButtons","buttons","html","useButton","indexOf","btn","key","push","join","getColorPanel","color","items1","items2","getStrokePanel","stroke","len","size","classes","getFontPanel","fontSize","selected","ArrayProto","Array","SelectorRegs","id","className","tagName","isObject","obj","isPlainObject","Object","toString","call","$","selector","context","trim","dom","test","getElementById","RegExp","$1","getElementsByClassName","getElementsByTagName","slice","each","object","callback","isArray","k","bind","element","eventType","sel","handler","e","nodes","matched","node","target","contains","apply","arguments","addEventListener","unbind","removeEventListener","getComputedStyles","defaultView","getComputedStyle","extend","out","keys","hasOwnProperty","$on","elements","index","$off","classList","type","STROKE_TYPES","STROKE_DEFAULT_COLOR","STROKE_DEFAULT_WIDTH","TEXT_HELPER_PADDING","TEXT_HELPER_FONT_SIZE","TEXT_FONT_FAMILY","buildStrokePanel","createElement","innerHTML","buildFontPanel","getTextHelper","$textHelper","setAttribute","body","appendChild","style","cssText","insertTextHelper","event","state","threshold","padding","pos","getPos","x","pageX","y","pageY","maxW","Math","floor","width","maxH","height","styleMap","display","position","top","left","strokeColor","overflow","focus","removeTextHelper","defaults","container","$saveLink","createElementNS","canUseSaveLink","_click","dispatchEvent","MouseEvent","__downloadFile","fileName","Date","now","canvas","fileUrl","toDataURL","replace","setTimeout","href","download","navigator","msToBlob","msSaveBlob","console","log","__bindEvents","self","$el","config","_handles","history","$btns","$fontPanel","$strokePanel","$colorSelected","$colors","$strokeWidth","$fontSize","btnEmit","stopPropagation","drawType","__drawFont","getAttribute","value","$btn","isActive","visible","pop","putImageData","__toggleCanvasCursor","toggleColor","background","toggleStrokeWidth","strokeWidth","Number","method","toggleFontSize","_startPos","onMouseDown","lastImageData","getImageData","lineCap","lineJoin","shadowBlur","strokeStyle","lineWidth","__drawRect","__drawEllipse","__drawBrush","onMouseMove","onMouseUp","__pushHistory","isEntry","start","clearRect","beginPath","strokeRect","restore","closePath","scaleX","scaleY","scale","arc","PI","moveTo","lineTo","content","textContent","parseFloat","lastSubStrIndex","fillStyle","char","measureText","fillText","substring","cursor","CanvasTools","options","getContext","Error","create","offsetTop","offsetLeft","render","C","S","parentNoed","removeChild"],"mappings":"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","file":"canvastools.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"CanvasTools\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"CanvasTools\"] = factory();\n\telse\n\t\troot[\"CanvasTools\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 0df0a4435c26247707fe","//Element.closet Polyfill\r\n//https://developer.mozilla.org/en-US/docs/Web/API/Element/closest\r\nif (window.Element && !Element.prototype.closest) {\r\n    Element.prototype.closest =\r\n        function(s) {\r\n            var matches = (this.document || this.ownerDocument).querySelectorAll(s),\r\n                i,\r\n                el = this;\r\n            do {\r\n                i = matches.length;\r\n                while (--i >= 0 && matches.item(i) !== el) {};\r\n            } while ((i < 0) && (el = el.parentElement));\r\n            return el;\r\n        };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/js/closet.js","const ButtonsMap = {\r\n\trect: {\r\n\t\tpanel: 'stroke',\r\n\t\tname: '矩形工具'\r\n\t},\r\n\tellipse: {\r\n\t\tpanel: 'stroke',\r\n\t\tname: '椭圆工具'\r\n\t},\r\n\tbrush: {\r\n\t\tpanel: 'stroke',\r\n\t\tname: '画笔工具'\r\n\t},\r\n\tarrow: {\r\n\t\tpanel: 'stroke',\r\n\t\tname: '箭头工具'\r\n\t},\r\n\tmosaic: {\r\n\t\tpanel: 'mosaic',\r\n\t\tname: '马赛克工具'\r\n\t},\r\n\tfont: {\r\n\t\tpanel: 'font',\r\n\t\tname: '文字工具'\r\n\t},\r\n\trubber: {\r\n\t\tname: '橡皮擦'\r\n\t},\r\n\tundo: {\r\n\t\tname: '撤销操作'\r\n\t},\r\n\tsave: {\r\n\t\tname: '保存'\r\n\t}\r\n}\r\n\r\n\r\n//可用颜色\r\nconst ColorList = ['#000000', '#808080', '#800000', '#f7883a', '#308430', '#385ad3', '#800080', '#009999', '#ffffff', '#c0c0c0', '#fb3838', '#ffff00', '#99cc00', '#3894e4', '#f31bf3', '#16dcdc']\r\n\r\n//可选择字号，Chrome不支持小于12号的字体\r\nconst FontSize = [12, 14, 16, 18, 20, 22]\r\n\r\n//画笔大小\r\nconst StrokeWidth = [2, 4, 6]\r\n\r\n\r\n/**\r\n * 获取buttons模版\r\n * @param  {Array}  buttons [可用按钮]\r\n * @return {String} \r\n */\r\nconst getButtons = (buttons = []) => {\r\n\tlet html = []\r\n\tconst useButton = btn => {\r\n\t\treturn buttons && !!~buttons.indexOf(btn)\r\n\t}\r\n\tfor (let key in ButtonsMap) {\r\n\t\tif (useButton(key)) {\r\n\t\t\tlet btn = ButtonsMap[key]\r\n\t\t\thtml.push(`<div class=\"canvas-tools-btn js-btn\" data-panel=\"${btn.panel || ''}\" data-value=\"${key}\" data-action=\"\" title=\"${btn.name}\">\r\n\t\t\t<a class=\"btn-toggle\"><i class=\"canvas-tools-icon__${key}\"></i></a>\r\n\t\t\t</div>`)\r\n\t\t}\r\n\t}\r\n\treturn html.join('')\r\n}\r\n\r\n\r\n/**\r\n * 获取颜色面板\r\n * @param  {String} color [当前选中色]\r\n * @return {String}\r\n */\r\nconst getColorPanel = (color = '#fb3838') => {\r\n\tlet html = ''\r\n\thtml += '<div class=\"colors\">'\r\n\thtml += `<span class=\"color-selected\"><i class=\"js-color-selected\" style=\"background:${color}\"></i></span>`\r\n\thtml += '<div class=\"color-list\">'\r\n\r\n\tlet items1 = [],\r\n\t\titems2 = []\r\n\tfor (let i = 0; i < 16; i++) {\r\n\t\tlet item = `<li class=\"js-color\" style=\"background:${ColorList[i]}\" data-value=\"${ColorList[i]}\"></li>`\r\n\t\tif (i < 8) {\r\n\t\t\titems1.push(item)\r\n\t\t} else {\r\n\t\t\titems2.push(item)\r\n\t\t}\r\n\t}\r\n\r\n\thtml += `<ul>${items1.join('')}</ul>`\r\n\thtml += `<ul>${items2.join('')}</ul>`\r\n\r\n\thtml += '</div>'\r\n\thtml += '</div>'\r\n\r\n\treturn html\r\n}\r\n\r\n\r\n/**\r\n * 获取画笔大小面板\r\n * @param  {Number} stroke [当前画笔大小]\r\n * @return {String}  \r\n */\r\nconst getStrokePanel = (stroke = 2) => {\r\n\tlet html = '<div class=\"strokes\">'\r\n\tfor (let i = 0, len = StrokeWidth.length; i < len; i++) {\r\n\t\tlet size = StrokeWidth[i]\r\n\t\tlet classes = ['stroke', 'js-stroke-width']\r\n\t\tsize === stroke && classes.push('active')\r\n\t\thtml += `<a class=\"${classes.join(' ')}\" data-value=\"${size}\"><i style=\"width:${size + 1}px;height:${size + 1}px;\"></i></a>`\r\n\t}\r\n\thtml += '</div>'\r\n\treturn html\r\n}\r\n\r\n\r\n/**\r\n * 获取字号选择器\r\n * @param  {Number} fontSize [默认字号]\r\n * @return {String} \r\n */\r\nconst getFontPanel = (fontSize = 12) => {\r\n\tlet html = '<select class=\"font-select js-font-size\">'\r\n\tfor (let i = 0, len = FontSize.length; i < len; i++) {\r\n\t\tlet size = FontSize[i]\r\n\t\tlet selected = !!(size === fontSize) ? 'selected' : ''\r\n\t\thtml += `<option value=\"${size}\" ${selected}>${size}</option>`\r\n\t}\r\n\thtml += '</select>'\r\n\treturn html\r\n}\r\n\r\nexport default {\r\n\tgetButtons,\r\n\tgetColorPanel,\r\n\tgetStrokePanel,\r\n\tgetFontPanel,\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/js/template.js","const ArrayProto = Array.prototype\r\n\r\nconst SelectorRegs = {\r\n\tid: /^#([\\w-]+)$/,\r\n\tclassName: /^\\.([\\w-]+)$/,\r\n\ttagName: /^[\\w-]+$/\r\n}\r\n\r\n\r\nconst isObject = obj => obj !== null && typeof obj === 'object'\r\n\r\n\r\nconst isPlainObject = obj => Object.prototype.toString.call(obj) === '[object Object]'\r\n\r\n\r\n\r\n/**\r\n * 获取元素对象集合\r\n * @param  {String} selector [选择器]\r\n * @param  {HTMLElement} context  [上下文对象]\r\n * @return {Array}          [元素节点集合]\r\n */\r\nconst $ = (selector = '*', context = document) => {\r\n\tif (typeof selector === \"string\") {\r\n\t\tselector = selector.trim()\r\n\t\tlet dom = [];\r\n\t\tif (SelectorRegs.id.test(selector)) {\r\n\t\t\tdom = document.getElementById(RegExp.$1)\r\n\t\t\tdom = dom ? [dom] : []\r\n\t\t} else if (SelectorRegs.className.test(selector)) {\r\n\t\t\tdom = context.getElementsByClassName(RegExp.$1)\r\n\t\t} else if (SelectorRegs.tagName.test(selector)) {\r\n\t\t\tdom = context.getElementsByTagName(selector)\r\n\t\t} else {\r\n\t\t\tdom = context.querySelectorAll(selector)\r\n\t\t}\r\n\t\treturn ArrayProto.slice.call(dom)\r\n\t}\r\n\treturn []\r\n}\r\n\r\n\r\n/**\r\n * 对象遍历\r\n * @param  {Object | Array}   object   [对象源]\r\n * @param  {Function} callback [回调]\r\n * @return  \r\n */\r\nconst each = (object, callback) => {\r\n\tif (typeof object === \"object\" && typeof callback === \"function\") {\r\n\t\tif (Array.isArray(object)) {\r\n\t\t\tfor (let i = 0, len = object.length; i < len; i++) {\r\n\t\t\t\tif (callback.call(object[i], i, object[i]) === false) {\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if ('length' in object && typeof object.length === \"number\") { //这地方不太严谨，谨慎使用\r\n\t\t\tfor (let k in object) {\r\n\t\t\t\tif (callback.call(object[k], k, object[k]) === false) {\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 事件绑定，支持代理\r\n * @param  {HTMLElement}   element   [DOM元素]\r\n * @param  {String}   eventType [事件类型]\r\n * @param  {String}   selector  [选择器]\r\n * @param  {Function} callback  [回调]\r\n * @return \r\n */\r\nconst bind = (element, eventType, selector, callback) => {\r\n\tlet sel, handler;\r\n\tif (typeof selector === \"function\") {\r\n\t\thandler = selector\r\n\t} else if (typeof selector === \"string\" && typeof callback === \"function\") {\r\n\t\tsel = selector\r\n\t} else {\r\n\t\treturn\r\n\t}\r\n\tif (sel) { //事件代理\r\n\t\thandler = function(e) {\r\n\t\t\tconst nodes = $(sel, element)\r\n\t\t\tlet matched = false\r\n\t\t\tfor (let i = 0, len = nodes.length; i < len; i++) {\r\n\t\t\t\tconst node = nodes[i]\r\n\t\t\t\tif (node === e.target || node.contains(e.target)) {\r\n\t\t\t\t\tmatched = node\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (matched) {\r\n\t\t\t\tcallback.apply(matched, ArrayProto.slice.call(arguments))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\telement.addEventListener(eventType, handler, false)\r\n}\r\n\r\n\r\n/**\r\n * 事件解绑\r\n * @param  {HTMLElement}   element   [DOM元素]\r\n * @param  {String}   eventType [事件类型]\r\n * @param  {Function} callback  [回调]\r\n * @return \r\n */\r\nconst unbind = (element, eventType, callback) => element.removeEventListener(eventType, callback, false)\r\n\r\n\r\n/**\r\n * 获取指定元素样式\r\n * @param  {HTMLElement} element\r\n * @return {Object}  \r\n */\r\nconst getComputedStyles = element => element.ownerDocument.defaultView.getComputedStyle(element, null)\r\n\r\n\r\n/**\r\n * 对象深度拷贝\r\n * @param  {Object} out\r\n * @return {Object}\r\n */\r\nconst extend = function(out = {}) {\r\n\tfor (let i = 1, len = arguments.length; i < len; i++) {\r\n\t\tlet obj = arguments[i]\r\n\t\tif (!obj || !Object.keys(obj).length)\r\n\t\t\tcontinue\r\n\t\tfor (let key in obj) {\r\n\t\t\tif (obj.hasOwnProperty(key)) {\r\n\t\t\t\tif (isPlainObject(obj[key]))\r\n\t\t\t\t\tout[key] = extend(out[key], obj[key])\r\n\t\t\t\telse\r\n\t\t\t\t\tout[key] = obj[key]\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn out\r\n}\r\n\r\n\r\nconst $on = (elements, eventType, selector, callback) => {\r\n\tif (!Array.isArray(elements)) {\r\n\t\telements = [elements]\r\n\t}\r\n\teach(elements, (index, element) => bind(element, eventType, selector, callback))\r\n}\r\n\r\nconst $off = (elements, eventType, callback) => {\r\n\tif (!Array.isArray(elements)) {\r\n\t\telements = [elements]\r\n\t}\r\n\teach(elements, (index, element) => unbind(element, eventType, callback))\r\n}\r\n\r\nconst classList = (elements, type = 'add', classes = '') => {\r\n\tif (!Array.isArray(elements)) {\r\n\t\telements = [elements]\r\n\t}\r\n\teach(elements, (index, element) => element.classList[type](classes))\r\n}\r\n\r\n\r\nexport default{\r\n\t$,\r\n\teach,\r\n\tbind,\r\n\textend,\r\n\tunbind,\r\n\tgetComputedStyles,\r\n\tclassList,\r\n\t$on,\r\n\t$off,\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/js/utils.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/scss/canvastools.scss\n// module id = 3\n// module chunks = 0","import '../scss/canvastools.scss'\r\nimport './closet'\r\nimport utils from './utils'\r\nimport Template from './template'\r\n\r\n//stroke类型操作\r\nconst STROKE_TYPES = ['rect', 'ellipse', 'brush', 'arrow', 'mosaic', 'font', 'rubber']\r\n\r\n//默认颜色\r\nconst STROKE_DEFAULT_COLOR = '#fb3838'\r\n\r\n//默认画笔大小\r\nconst STROKE_DEFAULT_WIDTH = 2\r\n\r\n//输入框padding值\r\nconst TEXT_HELPER_PADDING = 2\r\n\r\n//输入框默认字体大小\r\n//以设置的字体大小为准，改值仅做辅助值\r\nconst TEXT_HELPER_FONT_SIZE = 12\r\n\r\n//字体\r\nconst TEXT_FONT_FAMILY = '\"Helvetica Neue\",Helvetica,Arial,\"Hiragino Sans GB\",\"Hiragino Sans GB W3\",\"WenQuanYi Micro Hei\",sans-serif'\r\n\r\n\r\n/**\r\n * 创建画笔+颜色容器\r\n * @param  {Number} stroke [默认画笔]\r\n * @param  {String} color  [默认颜色]\r\n * @return {HTMLElement}   \r\n */\r\nconst buildStrokePanel = (stroke = STROKE_DEFAULT_COLOR, color = STROKE_DEFAULT_COLOR) => {\r\n\tconst el = document.createElement('div')\r\n\tel.className = 'canvas-tools__panel js-panel__stroke'\r\n\tel.innerHTML = Template.getStrokePanel(stroke) + Template.getColorPanel(color)\r\n\treturn el\r\n}\r\n\r\n/**\r\n * 创建字号+颜色容器\r\n * @param  {Number} fontSize [默认字号]\r\n * @param  {String} color  [默认颜色]\r\n * @return {HTMLElement}   \r\n */\r\nconst buildFontPanel = (fontSize = TEXT_HELPER_FONT_SIZE, color = STROKE_DEFAULT_COLOR) => {\r\n\tconst el = document.createElement('div')\r\n\tel.className = 'canvas-tools__panel js-panel__font'\r\n\tel.innerHTML = Template.getFontPanel(fontSize) + Template.getColorPanel(color)\r\n\treturn el\r\n}\r\n\r\n\r\n/**\r\n * 创建辅助文本输入框\r\n * @return {HTMLElement}\r\n */\r\nconst getTextHelper = () => {\r\n\tlet $textHelper = document.getElementById('canvas-tools-input')\r\n\tif (!$textHelper) {\r\n\t\t$textHelper = document.createElement('div')\r\n\t\t$textHelper.setAttribute('contenteditable', 'plaintext-only')\r\n\t\t$textHelper.setAttribute('spellcheck', 'false')\r\n\t\t$textHelper.setAttribute('id', 'canvas-tools-input')\r\n\t\t$textHelper.className = 'canvas-tools-input'\r\n\t\tdocument.body.appendChild($textHelper)\r\n\t}\r\n\t$textHelper.innerHTML = ''\r\n\t$textHelper.style.cssText = 'display: block';\r\n\treturn $textHelper\r\n}\r\n\r\n/**\r\n * 初始化辅助文本输入框样式\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @param  {Object} state [instance state]\r\n * @param  {Object} rect  [instance rect]\r\n * @return {HTMLElement}   \r\n */\r\nconst insertTextHelper = (event, state, rect) => {\r\n\tconst $textHelper = getTextHelper(),\r\n\t\tthreshold = state.fontSize || TEXT_HELPER_FONT_SIZE,\r\n\t\tpadding = 2 * TEXT_HELPER_PADDING + 2,\r\n\t\tpos = getPos(event, rect)\r\n\r\n\tlet x = event.pageX,\r\n\t\ty = event.pageY,\r\n\t\tmaxW = Math.floor(rect.width - pos.x) - padding,\r\n\t\tmaxH = Math.floor(rect.height - pos.y) - padding\r\n\r\n\tif (maxW <= threshold) {\r\n\t\tx -= (threshold + padding - maxW)\r\n\t\tmaxW = threshold\r\n\t}\r\n\r\n\tif (maxH <= threshold) {\r\n\t\ty -= (threshold + padding - maxH)\r\n\t\tmaxH = threshold\r\n\t}\r\n\r\n\tif (maxW >= rect.width) {\r\n\t\tmaxW = rect.width - pos.x\r\n\t}\r\n\r\n\tif (maxH >= rect.height) {\r\n\t\tmaxH = rect.height - pos.y\r\n\t}\r\n\r\n\tconst styleMap = {\r\n\t\t'font-size': threshold + 'px',\r\n\t\t'line-height': threshold + 'px',\r\n\t\t'min-width': threshold + 'px',\r\n\t\t'min-height': threshold + 'px',\r\n\t\t'max-width': maxW + 'px',\r\n\t\t'max-height': maxH + 'px',\r\n\t\t'z-index': 19900206,\r\n\t\t'font-family': TEXT_FONT_FAMILY,\r\n\t\tdisplay: 'block',\r\n\t\tposition: 'absolute',\r\n\t\ttop: y + 'px',\r\n\t\tleft: x + 'px',\r\n\t\tcolor: state.strokeColor,\r\n\t\tpadding: TEXT_HELPER_PADDING + 'px',\r\n\t\toverflow: 'hidden',\r\n\t}\r\n\r\n\tlet style = ''\r\n\r\n\tfor (let key in styleMap) {\r\n\t\tstyle += `${key}:${styleMap[key]};`\r\n\t}\r\n\r\n\t$textHelper.style.cssText = style\r\n\t$textHelper.focus()\r\n\treturn $textHelper\r\n}\r\n\r\n/**\r\n * 移除辅助文本输入框\r\n * @return \r\n */\r\nconst removeTextHelper = () => {\r\n\tlet $textHelper = document.getElementById('canvas-tools-input')\r\n\tif (!$textHelper) {\r\n\t\treturn\r\n\t}\r\n\t$textHelper.innerHTML = ''\r\n\t$textHelper.style.cssText = 'display: none';\r\n}\r\n\r\n\r\n/**\r\n * 获取鼠标在Canvas上的位置\r\n * @param  {Element Event} event [鼠标事件]\r\n * @param  {Object} rect  [Canvas rect]\r\n * @return {Object} \r\n */\r\nconst getPos = (event, rect) => {\r\n\tlet x = event.pageX - rect.left\r\n\tlet y = event.pageY - rect.top\r\n\r\n\tif (x <= 0) x = 0\r\n\tif (x >= rect.width) x = rect.width\r\n\tif (y <= 0) y = 0\r\n\tif (y >= rect.height) y = rect.height\r\n\r\n\treturn {\r\n\t\tx,\r\n\t\ty\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 默认配置\r\n * @type {Object}\r\n */\r\nconst defaults = {\r\n\t//工具条父级对象容器\r\n\tcontainer: document.body,\r\n\t//显示按钮\r\n\tbuttons: ['rect', 'ellipse', 'brush', 'font', 'undo', 'save']\r\n}\r\n\r\n\r\n//创建一个下载链接\r\nconst $saveLink = document.createElementNS('http://www.w3.org/1999/xhtml', 'a')\r\n\r\n//是否支持原生下载\r\nconst canUseSaveLink = 'download' in $saveLink\r\n\r\n//出发click事件\r\nconst _click = element => element.dispatchEvent(new MouseEvent(\"click\"))\r\n\r\n//下载文件\r\nconst __downloadFile = function () {\r\n\tconst fileName = `canvas_${Date.now()}.png`\r\n\tconst canvas = this.canvas\r\n\tlet fileUrl\r\n\tif (canUseSaveLink) {\r\n\t\tfileUrl = canvas.toDataURL('png')\r\n\t\tfileUrl = fileUrl.replace('image/png', 'image/octet-stream')\r\n\t\tsetTimeout(() => {\r\n\t\t\t$saveLink.href = fileUrl\r\n\t\t\t$saveLink.download = fileName\r\n\t\t\t_click($saveLink)\r\n\t\t})\r\n\t}\r\n\t//for ie10+ \r\n\telse if (typeof navigator !== \"undefined\" && typeof canvas.msToBlob === 'function' && navigator.msSaveBlob) {\r\n\t\tnavigator.msSaveBlob(canvas.msToBlob(), fileName)\r\n\t} else {\r\n\t\tconsole.log('您的浏览器不支持该操作')\r\n\t}\r\n}\r\n\r\n\r\n//相关事件绑定\r\nfunction __bindEvents() {\r\n\tconst self = this\r\n\tconst {\r\n\t\tcanvas,\r\n\t\tcontext,\r\n\t\t$el,\r\n\t\tstate,\r\n\t\tconfig,\r\n\t\trect,\r\n\t\t_handles,\r\n\t\thistory\r\n\t} = this\r\n\r\n\tconst $btns = utils.$('.js-btn', $el),\r\n\t\t$fontPanel = utils.$('.js-panel__font', $el)[0],\r\n\t\t$strokePanel = utils.$('.js-panel__stroke', $el)[0],\r\n\t\t$colorSelected = utils.$('.js-color-selected', $el),\r\n\t\t$colors = utils.$('.js-color', $el),\r\n\t\t$strokeWidth = utils.$('.js-stroke-width', $el),\r\n\t\t$fontSize = utils.$('.js-font-size', $el)\r\n\r\n\t//按钮事件\r\n\t_handles.btnEmit = function(event) {\r\n\t\tevent.stopPropagation()\r\n\t\tif (state.drawType === 'font') {\r\n\t\t\t__drawFont.call(self, event)\r\n\t\t}\r\n\t\tconst panel = this.getAttribute('data-panel')\r\n\t\tconst value = this.getAttribute('data-value')\r\n\t\tutils.each($btns, (index, $btn) => {\r\n\t\t\tif ($btn !== this) {\r\n\t\t\t\tutils.classList($btn, 'remove', 'active')\r\n\t\t\t}\r\n\t\t})\r\n\t\tif (!!~STROKE_TYPES.indexOf(value)) {\r\n\t\t\tstate.drawType = value\r\n\t\t}\r\n\t\tif (panel) {\r\n\t\t\tutils.classList(this, 'toggle', 'active')\r\n\t\t\tconst isActive = /active/.test(this.className)\r\n\t\t\tconst visible = isActive ? 'block' : 'none'\r\n\t\t\tif (panel === 'stroke') {\r\n\t\t\t\t$fontPanel.style.display = 'none'\r\n\t\t\t\t$strokePanel.style.display = visible\r\n\t\t\t} else if (panel === 'font') {\r\n\t\t\t\t$fontPanel.style.display = visible\r\n\t\t\t\t$strokePanel.style.display = 'none'\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//$fontPanel.style.display = 'none'\r\n\t\t\t//$strokePanel.style.display = 'none'\r\n\t\t}\r\n\r\n\t\tif (value === 'save') {\r\n\t\t\t__downloadFile.call(self)\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (value === 'undo') {\r\n\r\n\t\t\t//history[0]是画布的初始状态\r\n\t\t\t//因此只有多于1个历史记录时才可以恢复上一步\r\n\t\t\tif (history.length > 1) {\r\n\t\t\t\thistory.pop()\r\n\t\t\t\tcontext.putImageData(history[history.length - 1], 0, 0, 0, 0, rect.width, rect.height)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t__toggleCanvasCursor.call(self)\r\n\t}\r\n\r\n\t//切换颜色\r\n\t_handles.toggleColor = function(event) {\r\n\t\tconst color = this.getAttribute('data-value')\r\n\t\tstate.strokeColor = color\r\n\t\tutils.each($colorSelected, (index, item) => item.style.background = color)\r\n\t}\r\n\r\n\t//切换画笔大小\r\n\t_handles.toggleStrokeWidth = function(event) {\r\n\t\tstate.strokeWidth = Number(this.getAttribute('data-value'))\r\n\t\tutils.each($strokeWidth, (index, item) => {\r\n\t\t\tconst value = Number(item.getAttribute('data-value'))\r\n\t\t\tconst method = value === state.strokeWidth ? 'add' : 'remove'\r\n\t\t\tutils.classList(item, method, 'active')\r\n\t\t})\r\n\t}\r\n\r\n\t//切换fontSize\r\n\t_handles.toggleFontSize = function(event) {\r\n\t\tstate.fontSize = Number(this.value)\r\n\t}\r\n\r\n\t//鼠标在画布上的初始位置\r\n\tlet _startPos\r\n\r\n\r\n\t//鼠标点击\r\n\t_handles.onMouseDown = function(event) {\r\n\t\tif (!!~STROKE_TYPES.indexOf(state.drawType) === false || state.drawType === 'font') {\r\n\t\t\treturn\r\n\t\t}\r\n\t\t_startPos = getPos(event, rect)\r\n\r\n\t\t//保存当前快照\r\n\t\tstate.lastImageData = context.getImageData(0, 0, rect.width, rect.height)\r\n\r\n\t\t//初始化context状态\r\n\t\tcontext.lineCap = 'round'\r\n\t\tcontext.lineJoin = 'round'\r\n\t\tcontext.shadowBlur = 0\r\n\t\tcontext.strokeStyle = state.strokeColor\r\n\t\tcontext.lineWidth = state.strokeWidth\r\n\r\n\t\tswitch (state.drawType) {\r\n\t\t\tcase 'rect':\r\n\t\t\t\t__drawRect.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'ellipse':\r\n\t\t\t\t__drawEllipse.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'brush':\r\n\t\t\tdefault:\r\n\t\t\t\t__drawBrush.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t}\r\n\r\n\t\tutils.$on(document, 'mousemove', _handles.onMouseMove)\r\n\t\tutils.$on(document, 'mouseup', _handles.onMouseUp)\r\n\t}\r\n\r\n\t//鼠标移动\r\n\t_handles.onMouseMove = function(event) {\r\n\t\tif (!!~STROKE_TYPES.indexOf(state.drawType) === false || state.drawType === 'font') {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tswitch (state.drawType) {\r\n\t\t\tcase 'rect':\r\n\t\t\t\t__drawRect.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'ellipse':\r\n\t\t\t\t__drawEllipse.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'brush':\r\n\t\t\tdefault:\r\n\t\t\t\t__drawBrush.call(self, event, null)\r\n\t\t\t\tbreak\r\n\t\t}\r\n\t}\r\n\r\n\t//鼠标离开\r\n\t_handles.onMouseUp = function(event) {\r\n\t\tutils.$off(document, 'mousemove', _handles.onMouseMove)\r\n\t\tutils.$off(document, 'mouseup', _handles.onMouseUp)\r\n\t\tif (!!~STROKE_TYPES.indexOf(state.drawType) && state.drawType !== 'font') {\r\n\t\t\t__pushHistory.call(self)\r\n\t\t}\r\n\t}\r\n\r\n\t//插入文本输入框\r\n\t_handles.insertTextHelper = function(event) {\r\n\t\tevent.stopPropagation()\r\n\t\tif (state.drawType !== 'font') {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tif (state.isEntry) {\r\n\t\t\t__drawFont.call(self, event)\r\n\t\t\treturn\r\n\t\t}\r\n\t\tinsertTextHelper(event, state, rect)\r\n\t\tstate.isEntry = true\r\n\t}\r\n\r\n\t//移除文本输入框\r\n\t_handles.removeTextHelper = function(event) {\r\n\t\tif (state.drawType !== 'font') {\r\n\t\t\tremoveTextHelper()\r\n\t\t} else {\r\n\t\t\tif (!event.target.closest('#canvas-tools-input')) {\r\n\t\t\t\t__drawFont.call(self, event)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t\r\n\t//按钮事件\r\n\tutils.$on($btns, 'click', _handles.btnEmit)\r\n\r\n\t//切换颜色\r\n\tutils.$on($colors, 'click', _handles.toggleColor)\r\n\r\n\t//切换画笔大小\r\n\tutils.$on($strokeWidth, 'click', _handles.toggleStrokeWidth)\r\n\r\n\t//切换字体大小\r\n\tutils.$on($fontSize, 'change', _handles.toggleFontSize)\r\n\r\n\t//矩形，椭圆，画笔等绘制\r\n\tutils.$on(canvas, 'mousedown', _handles.onMouseDown)\r\n\r\n\t//文字输入\r\n\tutils.$on(canvas, 'click', _handles.insertTextHelper)\r\n\r\n\t//移除文字输入框\r\n\tutils.$on(document, 'click', _handles.removeTextHelper)\r\n\r\n}\r\n\r\n/**\r\n * 绘制矩形\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @param  {Object} start [起始位置]\r\n * @return \r\n */\r\nfunction __drawRect(event, start) {\r\n\tconst {\r\n\t\tcontext,\r\n\t\trect,\r\n\t\tstate\r\n\t} = this\r\n\tconst pos = getPos(event, rect)\r\n\tlet width = pos.x - start.x\r\n\tlet height = pos.y - start.y\r\n\r\n\tcontext.clearRect(0, 0, rect.width, rect.height)\r\n\tcontext.putImageData(state.lastImageData, 0, 0, 0, 0, rect.width, rect.height)\r\n\tcontext.save()\r\n\tcontext.beginPath()\r\n\tcontext.strokeRect(start.x, start.y, width, height)\r\n\tcontext.restore()\r\n\tcontext.closePath()\r\n}\r\n\r\n\r\n/**\r\n * 绘制椭圆\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @param  {Object} start [起始位置]\r\n * @return \r\n */\r\nfunction __drawEllipse(event, start) {\r\n\tconst {\r\n\t\tcontext,\r\n\t\trect,\r\n\t\tstate\r\n\t} = this\r\n\tconst pos = getPos(event, rect)\r\n\tlet scaleX = 1 * ((pos.x - start.x) / 2)\r\n\tlet scaleY = 1 * ((pos.y - start.y) / 2)\r\n\tlet x = (start.x / scaleX) + 1\r\n\tlet y = (start.y / scaleY) + 1\r\n\r\n\tcontext.clearRect(0, 0, rect.width, rect.height)\r\n\tcontext.putImageData(state.lastImageData, 0, 0, 0, 0, rect.width, rect.height)\r\n\tcontext.save()\r\n\tcontext.beginPath()\r\n\tcontext.scale(scaleX, scaleY)\r\n\tcontext.arc(x, y, 1, 0, 2 * Math.PI)\r\n\tcontext.restore()\r\n\tcontext.closePath()\r\n\tcontext.stroke()\r\n}\r\n\r\n/**\r\n * 画笔工具自由绘制\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @param  {Object | null} start [起始位置]\r\n * @return \r\n */\r\nfunction __drawBrush(event, start = null) {\r\n\tconst {\r\n\t\tcontext,\r\n\t\trect\r\n\t} = this\r\n\tif (start) {\r\n\t\tcontext.beginPath()\r\n\t\tcontext.moveTo(start.x, start.y)\r\n\t} else {\r\n\t\tconst pos = getPos(event, rect)\r\n\t\tcontext.lineTo(pos.x, pos.y)\r\n\t\tcontext.stroke()\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 绘制文字\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @return {[type]} \r\n */\r\nfunction __drawFont(event) {\r\n\tconst $textHelper = document.getElementById('canvas-tools-input')\r\n\tif (!$textHelper) {\r\n\t\tthis.state.isEntry = false\r\n\t\treturn\r\n\t}\r\n\tconst content = $textHelper.textContent.trim()\r\n\tconst length = content.length\r\n\tif (!content || !length) {\r\n\t\tthis.state.isEntry = false\r\n\t\tremoveTextHelper()\r\n\t\treturn\r\n\t}\r\n\r\n\tconst style = utils.getComputedStyles($textHelper),\r\n\t\tthreshold = this.state.fontSize || TEXT_HELPER_FONT_SIZE,\r\n\t\tpadding = 2 * TEXT_HELPER_PADDING,\r\n\t\tcontext = this.context\r\n\r\n\tlet x = parseFloat(style.left) - this.rect.left + padding - 2,\r\n\t\ty = parseFloat(style.top) - this.rect.top + threshold,\r\n\t\tlineWidth = 0,\r\n\t\tlastSubStrIndex = 0\r\n\r\n\tcontext.beginPath()\r\n\tcontext.save()\r\n\tcontext.fillStyle = this.state.strokeColor\r\n\tcontext.font = `${this.state.fontSize}px ${TEXT_FONT_FAMILY}`\r\n\r\n\tfor (let i = 0; i < length; i++) {\r\n\t\tlet char = content[i]\r\n\r\n\t\t//让文字自动换行\r\n\t\tlineWidth += context.measureText(char).width\r\n\r\n\t\tif (lineWidth > this.rect.width - x) {\r\n\t\t\tcontext.fillText(content.substring(lastSubStrIndex, i), x, y)\r\n\t\t\ty += threshold\r\n\t\t\tlineWidth = 0\r\n\t\t\tlastSubStrIndex = i\r\n\t\t}\r\n\t\tif (i == length - 1) {\r\n\t\t\tcontext.fillText(content.substring(lastSubStrIndex, i + 1), x, y);\r\n\t\t}\r\n\t}\r\n\tcontext.restore()\r\n\tcontext.closePath()\r\n\tthis.state.isEntry = false\r\n\tremoveTextHelper()\r\n\t__pushHistory.call(this)\r\n}\r\n\r\n\r\n/**\r\n * 切换鼠标指针\r\n * @return \r\n */\r\nfunction __toggleCanvasCursor() {\r\n\tconst canvas = this.canvas\r\n\tlet cursor\r\n\tswitch (this.state.drawType) {\r\n\t\tcase 'brush':\r\n\t\t\tcursor = 'brush'\r\n\t\t\tbreak\r\n\t\tcase 'font':\r\n\t\t\tcursor = 'font'\r\n\t\t\tbreak\r\n\t\tcase 'rect':\r\n\t\tcase 'ellipse':\r\n\t\t\tcursor = 'crosshair'\r\n\t\t\tbreak\r\n\t\tdefault:\r\n\t\t\tcursor = 'default'\r\n\t}\r\n\tif (cursor) {\r\n\t\tcanvas.className = canvas.className.replace(/canvas-cursor__(\\w+)/, '').trim() + ` canvas-cursor__${cursor}`\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 保存到历史记录\r\n * @return  \r\n */\r\nfunction __pushHistory() {\r\n\tthis.history.push(this.context.getImageData(0, 0, this.rect.width, this.rect.height))\r\n}\r\n\r\n\r\nclass CanvasTools {\r\n\tconstructor(canvas, options) {\r\n\t\tif (!canvas || typeof canvas.getContext !== 'function') {\r\n\t\t\tthrow new Error('invalid canvas object')\r\n\t\t}\r\n\t\tthis.canvas = canvas\r\n\t\tthis.context = canvas.getContext('2d')\r\n\t\tthis.config = utils.extend({}, defaults, options || {})\r\n\r\n\t\tthis.history = []\r\n\t\tthis.state = Object.create(null)\r\n\t\tthis.rect = Object.create(null)\r\n\t\tthis._handles = Object.create(null)\r\n\r\n\t\tthis.state.strokeWidth = STROKE_DEFAULT_WIDTH\r\n\t\tthis.state.fontSize = TEXT_HELPER_FONT_SIZE\r\n\t\tthis.state.strokeColor = STROKE_DEFAULT_COLOR\r\n\t\tthis.state.drawType = 'brush'\r\n\t\tthis.state.isEntry = false\r\n\t\tthis.rect.width = canvas.width\r\n\t\tthis.rect.height = canvas.height\r\n\t\tthis.rect.top = canvas.offsetTop\r\n\t\tthis.rect.left = canvas.offsetLeft\r\n\r\n\t\t//保存现场\r\n\t\tthis.state.lastImageData = this.context.getImageData(0, 0, this.rect.width, this.rect.height)\r\n\r\n\t\t//将画布的初始状态保存到历史记录\r\n\t\t__pushHistory.call(this)\r\n\r\n\t\t__toggleCanvasCursor.call(this)\r\n\r\n\t\tthis.render()\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst C = this.config\r\n\t\tconst S = this.state\r\n\t\tlet el = document.createElement('div')\r\n\t\tel.className = 'canvas-tools'\r\n\t\tel.innerHTML = Template.getButtons(C.buttons)\r\n\t\tC.container.appendChild(el)\r\n\r\n\t\tthis.$el = el\r\n\t\tthis.$el.appendChild(buildStrokePanel(S.strokeWidth, S.strokeColor))\r\n\t\tthis.$el.appendChild(buildFontPanel(S.fontSize, S.strokeColor))\r\n\t\t__bindEvents.call(this)\r\n\t}\r\n\r\n\r\n\tdestory() {\r\n\t\tconst {\r\n\t\t\tcanvas,\r\n\t\t\t$el,\r\n\t\t\t_handles\r\n\t\t} = this\r\n\r\n\t\tconst $btns = utils.$('.js-btn', $el),\r\n\t\t\t$colors = utils.$('.js-color', $el),\r\n\t\t\t$strokeWidth = utils.$('.js-stroke-width', $el),\r\n\t\t\t$fontSize = utils.$('.js-font-size', $el),\r\n\t\t\t$textHelper = document.getElementById('canvas-tools-input')\r\n\r\n\t\tutils.$off($btns, 'click', _handles.btnEmit)\r\n\t\tutils.$off($colors, 'click', _handles.toggleColor)\r\n\t\tutils.$off($strokeWidth, 'click', _handles.toggleStrokeWidth)\r\n\t\tutils.$off($fontSize, 'change', _handles.toggleFontSize)\r\n\t\tutils.$off(canvas, 'mousedown', _handles.onMouseDown)\r\n\t\tutils.$off(canvas, 'click', _handles.insertTextHelper)\r\n\t\tutils.$off(document, 'click', _handles.removeTextHelper)\r\n\t\t$textHelper && $textHelper.parentNoed.removeChild($textHelper)\r\n\t\tthis.canvas = null\r\n\t\tthis.context = null\r\n\t\tthis.history.length = 0\r\n\t}\r\n\r\n}\r\n\r\nexport default CanvasTools\n\n\n// WEBPACK FOOTER //\n// ./src/js/main.js"],"sourceRoot":""}