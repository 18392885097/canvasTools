{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap f96fdfccb87fd5c4ac78","webpack:///./src/scss/canvastools.scss","webpack:///./src/js/closet.js","webpack:///./src/js/template.js","webpack:///./src/js/utils.js","webpack:///./src/js/main.js"],"names":["window","Element","prototype","closest","s","matches","document","ownerDocument","querySelectorAll","i","el","length","item","parentElement","ButtonsMap","rect","panel","name","ellipse","brush","arrow","mosaic","font","rubber","undo","save","ColorList","FontSize","StrokeWidth","getButtons","buttons","html","useButton","indexOf","btn","key","push","join","getColorPanel","color","items1","items2","getStrokePanel","stroke","size","classes","getFontPanel","fontSize","selected","ArrayProto","Array","SelectorRegs","id","className","tagName","isObject","obj","isPlainObject","Object","toString","call","$","selector","context","trim","dom","test","getElementById","RegExp","$1","getElementsByClassName","getElementsByTagName","slice","each","object","callback","isArray","len","k","bind","element","eventType","sel","handler","e","nodes","matched","node","target","contains","apply","arguments","addEventListener","unbind","removeEventListener","getComputedStyles","defaultView","getComputedStyle","extend","out","keys","hasOwnProperty","$on","elements","index","$off","classList","type","utils","Template","STROKE_TYPES","STROKE_DEFAULT_COLOR","STROKE_DEFAULT_WIDTH","TEXT_HELPER_PADDING","TEXT_HELPER_FONT_SIZE","TEXT_FONT_FAMILY","buildStrokePanel","createElement","innerHTML","buildFontPanel","getTextHelper","$textHelper","setAttribute","body","appendChild","style","cssText","insertTextHelper","event","state","threshold","padding","pos","getPos","x","pageX","y","pageY","maxW","Math","floor","width","maxH","height","styleMap","display","position","top","left","strokeColor","overflow","focus","removeTextHelper","defaults","container","__bindEvents","self","canvas","$el","config","_handles","history","$btns","$fontPanel","$strokePanel","$colorSelected","$colors","$strokeWidth","$fontSize","$saveLink","btnEmit","stopPropagation","drawType","__drawFont","getAttribute","value","$btn","isActive","visible","pop","putImageData","__toggleCanvasCursor","toggleColor","background","toggleStrokeWidth","strokeWidth","Number","method","toggleFontSize","_startPos","onMouseDown","lastImageData","getImageData","lineCap","lineJoin","shadowBlur","strokeStyle","lineWidth","__drawRect","__drawEllipse","__drawBrush","onMouseMove","onMouseUp","__pushHistory","isEntry","download","imageData","toDataURL","replace","href","Date","now","start","clearRect","beginPath","strokeRect","restore","closePath","scaleX","scaleY","scale","arc","PI","moveTo","lineTo","content","textContent","parseFloat","lastSubStrIndex","fillStyle","char","measureText","fillText","substring","cursor","CanvasTools","options","getContext","Error","create","offsetTop","offsetLeft","render","C","S","parentNoed","removeChild"],"mappings":"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","file":"canvastools.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"CanvasTools\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"CanvasTools\"] = factory();\n\telse\n\t\troot[\"CanvasTools\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f96fdfccb87fd5c4ac78","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/scss/canvastools.scss\n// module id = 0\n// module chunks = 0","//Element.closet Polyfill\r\n//https://developer.mozilla.org/en-US/docs/Web/API/Element/closest\r\nif (window.Element && !Element.prototype.closest) {\r\n    Element.prototype.closest =\r\n        function(s) {\r\n            var matches = (this.document || this.ownerDocument).querySelectorAll(s),\r\n                i,\r\n                el = this;\r\n            do {\r\n                i = matches.length;\r\n                while (--i >= 0 && matches.item(i) !== el) {};\r\n            } while ((i < 0) && (el = el.parentElement));\r\n            return el;\r\n        };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/js/closet.js","const ButtonsMap = {\r\n\trect: {\r\n\t\tpanel: 'stroke',\r\n\t\tname: '矩形工具'\r\n\t},\r\n\tellipse: {\r\n\t\tpanel: 'stroke',\r\n\t\tname: '椭圆工具'\r\n\t},\r\n\tbrush: {\r\n\t\tpanel: 'stroke',\r\n\t\tname: '画笔工具'\r\n\t},\r\n\tarrow: {\r\n\t\tpanel: 'stroke',\r\n\t\tname: '箭头工具'\r\n\t},\r\n\tmosaic: {\r\n\t\tpanel: 'mosaic',\r\n\t\tname: '马赛克工具'\r\n\t},\r\n\tfont: {\r\n\t\tpanel: 'font',\r\n\t\tname: '文字工具'\r\n\t},\r\n\trubber: {\r\n\t\tname: '橡皮擦'\r\n\t},\r\n\tundo: {\r\n\t\tname: '撤销操作'\r\n\t},\r\n\tsave: {\r\n\t\tname: '保存'\r\n\t}\r\n}\r\n\r\n\r\n//可用颜色\r\nconst ColorList = ['#000000', '#808080', '#800000', '#f7883a', '#308430', '#385ad3', '#800080', '#009999', '#ffffff', '#c0c0c0', '#fb3838', '#ffff00', '#99cc00', '#3894e4', '#f31bf3', '#16dcdc']\r\n\r\n//可选择字号，Chrome不支持小于12号的字体\r\nconst FontSize = [12, 14, 16, 18, 20, 22]\r\n\r\n//画笔大小\r\nconst StrokeWidth = [2, 4, 6]\r\n\r\n\r\n/**\r\n * 获取buttons模版\r\n * @param  {Array}  buttons [可用按钮]\r\n * @return {String} \r\n */\r\nconst getButtons = (buttons = []) => {\r\n\tlet html = []\r\n\tconst useButton = btn => {\r\n\t\treturn buttons && !!~buttons.indexOf(btn)\r\n\t}\r\n\tfor (let key in ButtonsMap) {\r\n\t\tif (useButton(key)) {\r\n\t\t\tlet btn = ButtonsMap[key]\r\n\t\t\thtml.push(`<div class=\"canvas-tools-btn js-btn\" data-panel=\"${btn.panel || ''}\" data-value=\"${key}\" data-action=\"\" title=\"${btn.name}\">\r\n\t\t\t<a class=\"btn-toggle${key === 'save' ? ' js-canvas-save' : ''}\"><i class=\"canvas-tools-icon__${key}\"></i></a>\r\n\t\t\t</div>`)\r\n\t\t}\r\n\t}\r\n\treturn html.join('')\r\n}\r\n\r\n\r\n/**\r\n * 获取颜色面板\r\n * @param  {String} color [当前选中色]\r\n * @return {String}\r\n */\r\nconst getColorPanel = (color = '#fb3838') => {\r\n\tlet html = ''\r\n\thtml += '<div class=\"colors\">'\r\n\thtml += `<span class=\"color-selected\"><i class=\"js-color-selected\" style=\"background:${color}\"></i></span>`\r\n\thtml += '<div class=\"color-list\">'\r\n\r\n\tlet items1 = [],\r\n\t\titems2 = []\r\n\tfor (let i = 0; i < 16; i++) {\r\n\t\tlet item = `<li class=\"js-color\" style=\"background:${ColorList[i]}\" data-value=\"${ColorList[i]}\"></li>`\r\n\t\tif (i < 8) {\r\n\t\t\titems1.push(item)\r\n\t\t} else {\r\n\t\t\titems2.push(item)\r\n\t\t}\r\n\t}\r\n\r\n\thtml += `<ul>${items1.join('')}</ul>`\r\n\thtml += `<ul>${items2.join('')}</ul>`\r\n\r\n\thtml += '</div>'\r\n\thtml += '</div>'\r\n\r\n\treturn html\r\n}\r\n\r\n\r\n/**\r\n * 获取画笔大小面板\r\n * @param  {Number} stroke [当前画笔大小]\r\n * @return {String}  \r\n */\r\nconst getStrokePanel = (stroke = 2) => {\r\n\tlet html = '<div class=\"strokes\">'\r\n\tfor (let size of StrokeWidth) {\r\n\t\tlet classes = ['stroke', 'js-stroke-width']\r\n\t\tsize === stroke && classes.push('active')\r\n\t\thtml += `<a class=\"${classes.join(' ')}\" data-value=\"${size}\"><i style=\"width:${size + 1}px;height:${size + 1}px;\"></i></a>`\r\n\t}\r\n\thtml += '</div>'\r\n\treturn html\r\n}\r\n\r\n\r\n/**\r\n * 获取字号选择器\r\n * @param  {Number} fontSize [默认字号]\r\n * @return {String} \r\n */\r\nconst getFontPanel = (fontSize = 12) => {\r\n\tlet html = '<select class=\"font-select js-font-size\">'\r\n\tfor (let size of FontSize) {\r\n\t\tlet selected = !!(size === fontSize) ? 'selected' : ''\r\n\t\thtml += `<option value=\"${size}\" ${selected}>${size}</option>`\r\n\t}\r\n\thtml += '</select>'\r\n\treturn html\r\n}\r\n\r\n\r\n\r\nexport default {\r\n\tgetButtons,\r\n\tgetColorPanel,\r\n\tgetStrokePanel,\r\n\tgetFontPanel,\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/js/template.js","const ArrayProto = Array.prototype\r\n\r\nconst SelectorRegs = {\r\n\tid: /^#([\\w-]+)$/,\r\n\tclassName: /^\\.([\\w-]+)$/,\r\n\ttagName: /^[\\w-]+$/\r\n}\r\n\r\n\r\nconst isObject = obj => obj !== null && typeof obj === 'object'\r\n\r\n\r\nconst isPlainObject = obj => Object.prototype.toString.call(obj) === '[object Object]'\r\n\r\n\r\n\r\n/**\r\n * 获取元素对象集合\r\n * @param  {String} selector [选择器]\r\n * @param  {HTMLElement} context  [上下文对象]\r\n * @return {Array}          [元素节点集合]\r\n */\r\nconst $ = (selector = '*', context = document) => {\r\n\tif (typeof selector === \"string\") {\r\n\t\tselector = selector.trim()\r\n\t\tlet dom = [];\r\n\t\tif (SelectorRegs.id.test(selector)) {\r\n\t\t\tdom = document.getElementById(RegExp.$1)\r\n\t\t\tdom = dom ? [dom] : []\r\n\t\t} else if (SelectorRegs.className.test(selector)) {\r\n\t\t\tdom = context.getElementsByClassName(RegExp.$1)\r\n\t\t} else if (SelectorRegs.tagName.test(selector)) {\r\n\t\t\tdom = context.getElementsByTagName(selector)\r\n\t\t} else {\r\n\t\t\tdom = context.querySelectorAll(selector)\r\n\t\t}\r\n\t\treturn ArrayProto.slice.call(dom)\r\n\t}\r\n\treturn []\r\n}\r\n\r\n\r\n/**\r\n * 对象遍历\r\n * @param  {Object | Array}   object   [对象源]\r\n * @param  {Function} callback [回调]\r\n * @return  \r\n */\r\nconst each = (object, callback) => {\r\n\tif (typeof object === \"object\" && typeof callback === \"function\") {\r\n\t\tif (Array.isArray(object)) {\r\n\t\t\tfor (let i = 0, len = object.length; i < len; i++) {\r\n\t\t\t\tif (callback.call(object[i], i, object[i]) === false) {\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if ('length' in object && typeof object.length === \"number\") { //这地方不太严谨，谨慎使用\r\n\t\t\tfor (let k in object) {\r\n\t\t\t\tif (callback.call(object[k], k, object[k]) === false) {\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 事件绑定，支持代理\r\n * @param  {HTMLElement}   element   [DOM元素]\r\n * @param  {String}   eventType [事件类型]\r\n * @param  {String}   selector  [选择器]\r\n * @param  {Function} callback  [回调]\r\n * @return \r\n */\r\nconst bind = (element, eventType, selector, callback) => {\r\n\tlet sel, handler;\r\n\tif (typeof selector === \"function\") {\r\n\t\thandler = selector\r\n\t} else if (typeof selector === \"string\" && typeof callback === \"function\") {\r\n\t\tsel = selector\r\n\t} else {\r\n\t\treturn\r\n\t}\r\n\tif (sel) { //事件代理\r\n\t\thandler = function(e) {\r\n\t\t\tconst nodes = $(sel, element)\r\n\t\t\tlet matched = false\r\n\t\t\tfor (let i = 0, len = nodes.length; i < len; i++) {\r\n\t\t\t\tconst node = nodes[i]\r\n\t\t\t\tif (node === e.target || node.contains(e.target)) {\r\n\t\t\t\t\tmatched = node\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (matched) {\r\n\t\t\t\tcallback.apply(matched, ArrayProto.slice.call(arguments))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\telement.addEventListener(eventType, handler, false)\r\n}\r\n\r\n\r\n/**\r\n * 事件解绑\r\n * @param  {HTMLElement}   element   [DOM元素]\r\n * @param  {String}   eventType [事件类型]\r\n * @param  {Function} callback  [回调]\r\n * @return \r\n */\r\nconst unbind = (element, eventType, callback) => element.removeEventListener(eventType, callback, false)\r\n\r\n\r\n/**\r\n * 获取指定元素样式\r\n * @param  {HTMLElement} element\r\n * @return {Object}  \r\n */\r\nconst getComputedStyles = element => element.ownerDocument.defaultView.getComputedStyle(element, null)\r\n\r\n\r\n/**\r\n * 对象深度拷贝\r\n * @param  {Object} out\r\n * @return {Object}\r\n */\r\nconst extend = function(out = {}) {\r\n\tfor (let i = 1, len = arguments.length; i < len; i++) {\r\n\t\tlet obj = arguments[i]\r\n\t\tif (!obj || !Object.keys(obj).length)\r\n\t\t\tcontinue\r\n\t\tfor (let key in obj) {\r\n\t\t\tif (obj.hasOwnProperty(key)) {\r\n\t\t\t\tif (isPlainObject(obj[key]))\r\n\t\t\t\t\tout[key] = extend(out[key], obj[key])\r\n\t\t\t\telse\r\n\t\t\t\t\tout[key] = obj[key]\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn out\r\n}\r\n\r\n\r\nconst $on = (elements, eventType, selector, callback) => {\r\n\tif (!Array.isArray(elements)) {\r\n\t\telements = [elements]\r\n\t}\r\n\teach(elements, (index, element) => bind(element, eventType, selector, callback))\r\n}\r\n\r\nconst $off = (elements, eventType, callback) => {\r\n\tif (!Array.isArray(elements)) {\r\n\t\telements = [elements]\r\n\t}\r\n\teach(elements, (index, element) => unbind(element, eventType, callback))\r\n}\r\n\r\nconst classList = (elements, type = 'add', classes = '') => {\r\n\tif (!Array.isArray(elements)) {\r\n\t\telements = [elements]\r\n\t}\r\n\teach(elements, (index, element) => element.classList[type](classes))\r\n}\r\n\r\n\r\nexport {\r\n\t$,\r\n\teach,\r\n\tbind,\r\n\textend,\r\n\tunbind,\r\n\tgetComputedStyles,\r\n\tclassList,\r\n\t$on,\r\n\t$off,\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/js/utils.js","import '../scss/canvastools.scss'\r\nimport './closet'\r\nimport * as utils from './utils'\r\nimport * as Template from './template'\r\n\r\n//stroke类型操作\r\nconst STROKE_TYPES = ['rect', 'ellipse', 'brush', 'arrow', 'mosaic', 'font', 'rubber']\r\n\r\n//默认颜色\r\nconst STROKE_DEFAULT_COLOR = '#fb3838'\r\n\r\n//默认画笔大小\r\nconst STROKE_DEFAULT_WIDTH = 2\r\n\r\n//输入框padding值\r\nconst TEXT_HELPER_PADDING = 2\r\n\r\n//输入框默认字体大小\r\n//以设置的字体大小为准，改值仅做辅助值\r\nconst TEXT_HELPER_FONT_SIZE = 12\r\n\r\n//字体\r\nconst TEXT_FONT_FAMILY = '\"Helvetica Neue\",Helvetica,Arial,\"Hiragino Sans GB\",\"Hiragino Sans GB W3\",\"WenQuanYi Micro Hei\",sans-serif'\r\n\r\n\r\n/**\r\n * 创建画笔+颜色容器\r\n * @param  {Number} stroke [默认画笔]\r\n * @param  {String} color  [默认颜色]\r\n * @return {HTMLElement}   \r\n */\r\nconst buildStrokePanel = (stroke = STROKE_DEFAULT_COLOR, color = STROKE_DEFAULT_COLOR) => {\r\n\tconst el = document.createElement('div')\r\n\tel.className = 'canvas-tools__panel js-panel__stroke'\r\n\tel.innerHTML = Template.getStrokePanel(stroke) + Template.getColorPanel(color)\r\n\treturn el\r\n}\r\n\r\n/**\r\n * 创建字号+颜色容器\r\n * @param  {Number} fontSize [默认字号]\r\n * @param  {String} color  [默认颜色]\r\n * @return {HTMLElement}   \r\n */\r\nconst buildFontPanel = (fontSize = TEXT_HELPER_FONT_SIZE, color = STROKE_DEFAULT_COLOR) => {\r\n\tconst el = document.createElement('div')\r\n\tel.className = 'canvas-tools__panel js-panel__font'\r\n\tel.innerHTML = Template.getFontPanel(fontSize) + Template.getColorPanel(color)\r\n\treturn el\r\n}\r\n\r\n\r\n/**\r\n * 创建辅助文本输入框\r\n * @return {HTMLElement}\r\n */\r\nconst getTextHelper = () => {\r\n\tlet $textHelper = document.getElementById('canvas-tools-input')\r\n\tif (!$textHelper) {\r\n\t\t$textHelper = document.createElement('div')\r\n\t\t$textHelper.setAttribute('contenteditable', 'plaintext-only')\r\n\t\t$textHelper.setAttribute('spellcheck', 'false')\r\n\t\t$textHelper.setAttribute('id', 'canvas-tools-input')\r\n\t\t$textHelper.className = 'canvas-tools-input'\r\n\t\tdocument.body.appendChild($textHelper)\r\n\t}\r\n\t$textHelper.innerHTML = ''\r\n\t$textHelper.style.cssText = 'display: block';\r\n\treturn $textHelper\r\n}\r\n\r\n/**\r\n * 初始化辅助文本输入框样式\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @param  {Object} state [instance state]\r\n * @param  {Object} rect  [instance rect]\r\n * @return {HTMLElement}   \r\n */\r\nconst insertTextHelper = (event, state, rect) => {\r\n\tconst $textHelper = getTextHelper(),\r\n\t\tthreshold = state.fontSize || TEXT_HELPER_FONT_SIZE,\r\n\t\tpadding = 2 * TEXT_HELPER_PADDING + 2,\r\n\t\tpos = getPos(event, rect)\r\n\r\n\tlet x = event.pageX,\r\n\t\ty = event.pageY,\r\n\t\tmaxW = Math.floor(rect.width - pos.x) - padding,\r\n\t\tmaxH = Math.floor(rect.height - pos.y) - padding\r\n\r\n\tif (maxW <= threshold) {\r\n\t\tx -= (threshold + padding - maxW)\r\n\t\tmaxW = threshold\r\n\t}\r\n\r\n\tif (maxH <= threshold) {\r\n\t\ty -= (threshold + padding - maxH)\r\n\t\tmaxH = threshold\r\n\t}\r\n\r\n\tif (maxW >= rect.width) {\r\n\t\tmaxW = rect.width - pos.x\r\n\t}\r\n\r\n\tif (maxH >= rect.height) {\r\n\t\tmaxH = rect.height - pos.y\r\n\t}\r\n\r\n\tconst styleMap = {\r\n\t\t'font-size': threshold + 'px',\r\n\t\t'line-height': threshold + 'px',\r\n\t\t'min-width': threshold + 'px',\r\n\t\t'min-height': threshold + 'px',\r\n\t\t'max-width': maxW + 'px',\r\n\t\t'max-height': maxH + 'px',\r\n\t\t'z-index': 19900206,\r\n\t\t'font-family': TEXT_FONT_FAMILY,\r\n\t\tdisplay: 'block',\r\n\t\tposition: 'fixed',\r\n\t\ttop: y + 'px',\r\n\t\tleft: x + 'px',\r\n\t\tcolor: state.strokeColor,\r\n\t\tpadding: TEXT_HELPER_PADDING + 'px',\r\n\t\toverflow: 'hidden',\r\n\t}\r\n\r\n\tlet style = ''\r\n\r\n\tfor (let key in styleMap) {\r\n\t\tstyle += `${key}:${styleMap[key]};`\r\n\t}\r\n\r\n\t$textHelper.style.cssText = style\r\n\t$textHelper.focus()\r\n\treturn $textHelper\r\n}\r\n\r\n/**\r\n * 移除辅助文本输入框\r\n * @return \r\n */\r\nconst removeTextHelper = () => {\r\n\tlet $textHelper = document.getElementById('canvas-tools-input')\r\n\tif (!$textHelper) {\r\n\t\treturn\r\n\t}\r\n\t$textHelper.innerHTML = ''\r\n\t$textHelper.style.cssText = 'display: none';\r\n}\r\n\r\n\r\n\r\n/**\r\n * 获取鼠标在Canvas上的位置\r\n * @param  {Element Event} event [鼠标事件]\r\n * @param  {Object} rect  [Canvas rect]\r\n * @return {Object} \r\n */\r\nconst getPos = (event, rect) => {\r\n\tlet x = event.pageX - rect.left\r\n\tlet y = event.pageY - rect.top\r\n\r\n\tif (x <= 0) x = 0\r\n\tif (x >= rect.width) x = rect.width\r\n\tif (y <= 0) y = 0\r\n\tif (y >= rect.height) y = rect.height\r\n\r\n\treturn {\r\n\t\tx,\r\n\t\ty\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 默认配置\r\n * @type {Object}\r\n */\r\nconst defaults = {\r\n\t//工具条父级对象容器\r\n\tcontainer: document.body,\r\n\t//显示按钮\r\n\tbuttons: ['rect', 'ellipse', 'brush', 'font', 'undo', 'save']\r\n}\r\n\r\n\r\n\r\n//相关事件绑定\r\nfunction __bindEvents() {\r\n\tconst self = this\r\n\tconst {\r\n\t\tcanvas,\r\n\t\tcontext,\r\n\t\t$el,\r\n\t\tstate,\r\n\t\tconfig,\r\n\t\trect,\r\n\t\t_handles,\r\n\t\thistory\r\n\t} = this\r\n\r\n\tconst $btns = utils.$('.js-btn', $el),\r\n\t\t$fontPanel = utils.$('.js-panel__font', $el)[0],\r\n\t\t$strokePanel = utils.$('.js-panel__stroke', $el)[0],\r\n\t\t$colorSelected = utils.$('.js-color-selected', $el),\r\n\t\t$colors = utils.$('.js-color', $el),\r\n\t\t$strokeWidth = utils.$('.js-stroke-width', $el),\r\n\t\t$fontSize = utils.$('.js-font-size', $el),\r\n\t\t$saveLink = utils.$('.js-canvas-save', $el)[0]\r\n\r\n\t//按钮事件\r\n\t_handles.btnEmit = function(event) {\r\n\t\tevent.stopPropagation()\r\n\t\tif (state.drawType === 'font') {\r\n\t\t\t__drawFont.call(self, event)\r\n\t\t}\r\n\t\tconst panel = this.getAttribute('data-panel')\r\n\t\tconst value = this.getAttribute('data-value')\r\n\t\tutils.each($btns, (index, $btn) => {\r\n\t\t\tif ($btn !== this) {\r\n\t\t\t\tutils.classList($btn, 'remove', 'active')\r\n\t\t\t}\r\n\t\t})\r\n\t\tif (!!~STROKE_TYPES.indexOf(value)) {\r\n\t\t\tstate.drawType = value\r\n\t\t}\r\n\t\tif (panel) {\r\n\t\t\tutils.classList(this, 'toggle', 'active')\r\n\t\t\tconst isActive = /active/.test(this.className)\r\n\t\t\tconst visible = isActive ? 'block' : 'none'\r\n\t\t\tif (panel === 'stroke') {\r\n\t\t\t\t$fontPanel.style.display = 'none'\r\n\t\t\t\t$strokePanel.style.display = visible\r\n\t\t\t} else if (panel === 'font') {\r\n\t\t\t\t$fontPanel.style.display = visible\r\n\t\t\t\t$strokePanel.style.display = 'none'\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//$fontPanel.style.display = 'none'\r\n\t\t\t//$strokePanel.style.display = 'none'\r\n\t\t}\r\n\r\n\t\tif (value === 'undo') {\r\n\r\n\t\t\t//history[0]是画布的初始状态\r\n\t\t\t//因此只有多于1个历史记录时才可以恢复上一步\r\n\t\t\tif (history.length > 1) {\r\n\t\t\t\thistory.pop()\r\n\t\t\t\tcontext.putImageData(history[history.length - 1], 0, 0, 0, 0, rect.width, rect.height)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t__toggleCanvasCursor.call(self)\r\n\t}\r\n\r\n\t//切换颜色\r\n\t_handles.toggleColor = function(event) {\r\n\t\tconst color = this.getAttribute('data-value')\r\n\t\tstate.strokeColor = color\r\n\t\tutils.each($colorSelected, (index, item) => item.style.background = color)\r\n\t}\r\n\r\n\t//切换画笔大小\r\n\t_handles.toggleStrokeWidth = function(event) {\r\n\t\tstate.strokeWidth = Number(this.getAttribute('data-value'))\r\n\t\tutils.each($strokeWidth, (index, item) => {\r\n\t\t\tconst value = Number(item.getAttribute('data-value'))\r\n\t\t\tconst method = value === state.strokeWidth ? 'add' : 'remove'\r\n\t\t\tutils.classList(item, method, 'active')\r\n\t\t})\r\n\t}\r\n\r\n\t//切换fontSize\r\n\t_handles.toggleFontSize = function(event) {\r\n\t\tstate.fontSize = Number(this.value)\r\n\t}\r\n\r\n\t//鼠标在画布上的初始位置\r\n\tlet _startPos\r\n\r\n\r\n\t//鼠标点击\r\n\t_handles.onMouseDown = function(event) {\r\n\t\tif (!!~STROKE_TYPES.indexOf(state.drawType) === false || state.drawType === 'font') {\r\n\t\t\treturn\r\n\t\t}\r\n\t\t_startPos = getPos(event, rect)\r\n\r\n\t\t//保存当前快照\r\n\t\tstate.lastImageData = context.getImageData(0, 0, rect.width, rect.height)\r\n\r\n\t\t//初始化context状态\r\n\t\tcontext.lineCap = 'round'\r\n\t\tcontext.lineJoin = 'round'\r\n\t\tcontext.shadowBlur = 0\r\n\t\tcontext.strokeStyle = state.strokeColor\r\n\t\tcontext.lineWidth = state.strokeWidth\r\n\r\n\t\tswitch (state.drawType) {\r\n\t\t\tcase 'rect':\r\n\t\t\t\t__drawRect.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'ellipse':\r\n\t\t\t\t__drawEllipse.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'brush':\r\n\t\t\tdefault:\r\n\t\t\t\t__drawBrush.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t}\r\n\r\n\t\tutils.$on(document, 'mousemove', _handles.onMouseMove)\r\n\t\tutils.$on(document, 'mouseup', _handles.onMouseUp)\r\n\t}\r\n\r\n\t//鼠标移动\r\n\t_handles.onMouseMove = function(event) {\r\n\t\tif (!!~STROKE_TYPES.indexOf(state.drawType) === false || state.drawType === 'font') {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tswitch (state.drawType) {\r\n\t\t\tcase 'rect':\r\n\t\t\t\t__drawRect.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'ellipse':\r\n\t\t\t\t__drawEllipse.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'brush':\r\n\t\t\tdefault:\r\n\t\t\t\t__drawBrush.call(self, event, null)\r\n\t\t\t\tbreak\r\n\t\t}\r\n\t}\r\n\r\n\t//鼠标离开\r\n\t_handles.onMouseUp = function(event) {\r\n\t\tutils.$off(document, 'mousemove', _handles.onMouseMove)\r\n\t\tutils.$off(document, 'mouseup', _handles.onMouseUp)\r\n\t\tif (!!~STROKE_TYPES.indexOf(state.drawType) && state.drawType !== 'font') {\r\n\t\t\t__pushHistory.call(self)\r\n\t\t}\r\n\t}\r\n\r\n\t//插入文本输入框\r\n\t_handles.insertTextHelper = function(event) {\r\n\t\tevent.stopPropagation()\r\n\t\tif (state.drawType !== 'font') {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tif (state.isEntry) {\r\n\t\t\t__drawFont.call(self, event)\r\n\t\t\treturn\r\n\t\t}\r\n\t\tinsertTextHelper(event, state, rect)\r\n\t\tstate.isEntry = true\r\n\t}\r\n\r\n\t//移除文本输入框\r\n\t_handles.removeTextHelper = function(event) {\r\n\t\tif (state.drawType !== 'font') {\r\n\t\t\tremoveTextHelper()\r\n\t\t} else {\r\n\t\t\tif (!event.target.closest('#canvas-tools-input')) {\r\n\t\t\t\t__drawFont.call(self, event)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t//下载\r\n\t_handles.download = function(event) {\r\n\t\tevent.stopPropagation()\r\n\t\tlet imageData = canvas.toDataURL('png')\r\n\t\timageData = imageData.replace('image/png', 'image/octet-stream')\r\n\t\tthis.href = imageData\r\n\t\tthis.download = `canvas_${Date.now()}.png`\r\n\t}\r\n\r\n\t//按钮事件\r\n\tutils.$on($btns, 'click', _handles.btnEmit)\r\n\r\n\t//切换颜色\r\n\tutils.$on($colors, 'click', _handles.toggleColor)\r\n\r\n\t//切换画笔大小\r\n\tutils.$on($strokeWidth, 'click', _handles.toggleStrokeWidth)\r\n\r\n\t//切换字体大小\r\n\tutils.$on($fontSize, 'change', _handles.toggleFontSize)\r\n\r\n\t//矩形，椭圆，画笔等绘制\r\n\tutils.$on(canvas, 'mousedown', _handles.onMouseDown)\r\n\r\n\t//文字输入\r\n\tutils.$on(canvas, 'click', _handles.insertTextHelper)\r\n\r\n\t//移除文字输入框\r\n\tutils.$on(document, 'click', _handles.removeTextHelper)\r\n\r\n\t//下载\r\n\tutils.$on($saveLink, 'click', _handles.download)\r\n}\r\n\r\n/**\r\n * 绘制矩形\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @param  {Object} start [起始位置]\r\n * @return \r\n */\r\nfunction __drawRect(event, start) {\r\n\tconst {\r\n\t\tcontext,\r\n\t\trect,\r\n\t\tstate\r\n\t} = this\r\n\tconst pos = getPos(event, rect)\r\n\tlet width = pos.x - start.x\r\n\tlet height = pos.y - start.y\r\n\r\n\tcontext.clearRect(0, 0, rect.width, rect.height)\r\n\tcontext.putImageData(state.lastImageData, 0, 0, 0, 0, rect.width, rect.height)\r\n\tcontext.save()\r\n\tcontext.beginPath()\r\n\tcontext.strokeRect(start.x, start.y, width, height)\r\n\tcontext.restore()\r\n\tcontext.closePath()\r\n}\r\n\r\n\r\n/**\r\n * 绘制椭圆\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @param  {Object} start [起始位置]\r\n * @return \r\n */\r\nfunction __drawEllipse(event, start) {\r\n\tconst {\r\n\t\tcontext,\r\n\t\trect,\r\n\t\tstate\r\n\t} = this\r\n\tconst pos = getPos(event, rect)\r\n\tlet scaleX = 1 * ((pos.x - start.x) / 2)\r\n\tlet scaleY = 1 * ((pos.y - start.y) / 2)\r\n\tlet x = (start.x / scaleX) + 1\r\n\tlet y = (start.y / scaleY) + 1\r\n\r\n\tcontext.clearRect(0, 0, rect.width, rect.height)\r\n\tcontext.putImageData(state.lastImageData, 0, 0, 0, 0, rect.width, rect.height)\r\n\tcontext.save()\r\n\tcontext.beginPath()\r\n\tcontext.scale(scaleX, scaleY)\r\n\tcontext.arc(x, y, 1, 0, 2 * Math.PI)\r\n\tcontext.restore()\r\n\tcontext.closePath()\r\n\tcontext.stroke()\r\n}\r\n\r\n/**\r\n * 画笔工具自由绘制\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @param  {Object | null} start [起始位置]\r\n * @return \r\n */\r\nfunction __drawBrush(event, start = null) {\r\n\tconst {\r\n\t\tcontext,\r\n\t\trect\r\n\t} = this\r\n\tif (start) {\r\n\t\tcontext.beginPath()\r\n\t\tcontext.moveTo(start.x, start.y)\r\n\t} else {\r\n\t\tconst pos = getPos(event, rect)\r\n\t\tcontext.lineTo(pos.x, pos.y)\r\n\t\tcontext.stroke()\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 绘制文字\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @return {[type]} \r\n */\r\nfunction __drawFont(event) {\r\n\tconst $textHelper = document.getElementById('canvas-tools-input')\r\n\tif (!$textHelper) {\r\n\t\tthis.state.isEntry = false\r\n\t\treturn\r\n\t}\r\n\tconst content = $textHelper.textContent.trim()\r\n\tconst length = content.length\r\n\tif (!content || !length) {\r\n\t\tthis.state.isEntry = false\r\n\t\tremoveTextHelper()\r\n\t\treturn\r\n\t}\r\n\r\n\tconst style = utils.getComputedStyles($textHelper),\r\n\t\tthreshold = this.state.fontSize || TEXT_HELPER_FONT_SIZE,\r\n\t\tpadding = 2 * TEXT_HELPER_PADDING,\r\n\t\tcontext = this.context\r\n\r\n\tlet x = parseFloat(style.left) - this.rect.left + padding - 2,\r\n\t\ty = parseFloat(style.top) - this.rect.top + threshold,\r\n\t\tlineWidth = 0,\r\n\t\tlastSubStrIndex = 0\r\n\r\n\tcontext.beginPath()\r\n\tcontext.save()\r\n\tcontext.fillStyle = this.state.strokeColor\r\n\tcontext.font = `${this.state.fontSize}px ${TEXT_FONT_FAMILY}`\r\n\r\n\tfor (let i = 0; i < length; i++) {\r\n\t\tlet char = content[i]\r\n\r\n\t\t//让文字自动换行\r\n\t\tlineWidth += context.measureText(char).width\r\n\r\n\t\tif (lineWidth > this.rect.width - x) {\r\n\t\t\tcontext.fillText(content.substring(lastSubStrIndex, i), x, y)\r\n\t\t\ty += threshold\r\n\t\t\tlineWidth = 0\r\n\t\t\tlastSubStrIndex = i\r\n\t\t}\r\n\t\tif (i == length - 1) {\r\n\t\t\tcontext.fillText(content.substring(lastSubStrIndex, i + 1), x, y);\r\n\t\t}\r\n\t}\r\n\tcontext.restore()\r\n\tcontext.closePath()\r\n\tthis.state.isEntry = false\r\n\tremoveTextHelper()\r\n\t__pushHistory.call(this)\r\n}\r\n\r\n\r\n/**\r\n * 切换鼠标指针\r\n * @return \r\n */\r\nfunction __toggleCanvasCursor() {\r\n\tconst canvas = this.canvas\r\n\tlet cursor\r\n\tswitch (this.state.drawType) {\r\n\t\tcase 'brush':\r\n\t\t\tcursor = 'brush'\r\n\t\t\tbreak\r\n\t\tcase 'font' :\r\n\t\t\tcursor = 'font'\r\n\t\t\tbreak\t\r\n\t\tcase 'rect':\r\n\t\tcase 'ellipse':\r\n\t\t\tcursor = 'crosshair'\r\n\t\t\tbreak\r\n\t\tdefault : \r\n\t\t\tcursor = 'default'\t\r\n\t}\r\n\tif (cursor) {\r\n\t\tcanvas.className = canvas.className.replace(/canvas-cursor__(\\w+)/, '').trim() + ` canvas-cursor__${cursor}`\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 保存到历史记录\r\n * @return  \r\n */\r\nfunction __pushHistory() {\r\n\tthis.history.push(this.context.getImageData(0, 0, this.rect.width, this.rect.height))\r\n}\r\n\r\n\r\nclass CanvasTools {\r\n\tconstructor(canvas, options) {\r\n\t\tif (!canvas || typeof canvas.getContext !== 'function') {\r\n\t\t\tthrow new Error('invalid canvas object')\r\n\t\t}\r\n\t\tthis.canvas = canvas\r\n\t\tthis.context = canvas.getContext('2d')\r\n\t\tthis.config = utils.extend({}, defaults, options || {})\r\n\r\n\t\tthis.history = []\r\n\t\tthis.state = Object.create(null)\r\n\t\tthis.rect = Object.create(null)\r\n\t\tthis._handles = Object.create(null)\r\n\r\n\t\tthis.state.strokeWidth = STROKE_DEFAULT_WIDTH\r\n\t\tthis.state.fontSize = TEXT_HELPER_FONT_SIZE\r\n\t\tthis.state.strokeColor = STROKE_DEFAULT_COLOR\r\n\t\tthis.state.drawType = 'brush'\r\n\t\tthis.state.isEntry = false\r\n\t\tthis.rect.width = canvas.width\r\n\t\tthis.rect.height = canvas.height\r\n\t\tthis.rect.top = canvas.offsetTop\r\n\t\tthis.rect.left = canvas.offsetLeft\r\n\r\n\t\t//保存现场\r\n\t\tthis.state.lastImageData = this.context.getImageData(0, 0, this.rect.width, this.rect.height)\r\n\r\n\t\t//将画布的初始状态保存到历史记录\r\n\t\t__pushHistory.call(this)\r\n\r\n\t\t__toggleCanvasCursor.call(this)\r\n\r\n\t\tthis.render()\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst C = this.config\r\n\t\tconst S = this.state\r\n\t\tlet el = document.createElement('div')\r\n\t\tel.className = 'canvas-tools'\r\n\t\tel.innerHTML = Template.getButtons(C.buttons)\r\n\t\tC.container.appendChild(el)\r\n\r\n\t\tthis.$el = el\r\n\t\tthis.$el.appendChild(buildStrokePanel(S.strokeWidth, S.strokeColor))\r\n\t\tthis.$el.appendChild(buildFontPanel(S.fontSize, S.strokeColor))\r\n\t\t__bindEvents.call(this)\r\n\t}\r\n\r\n\r\n\tdestory() {\r\n\t\tconst {\r\n\t\t\tcanvas,\r\n\t\t\t$el,\r\n\t\t\t_handles\r\n\t\t} = this\r\n\r\n\t\tconst $btns = utils.$('.js-btn', $el),\r\n\t\t\t$colors = utils.$('.js-color', $el),\r\n\t\t\t$strokeWidth = utils.$('.js-stroke-width', $el),\r\n\t\t\t$fontSize = utils.$('.js-font-size', $el),\r\n\t\t\t$saveLink = utils.$('.js-canvas-save', $el)[0],\r\n\t\t\t$textHelper = document.getElementById('canvas-tools-input')\r\n\r\n\t\tutils.$off($btns, 'click', _handles.btnEmit)\r\n\t\tutils.$off($colors, 'click', _handles.toggleColor)\r\n\t\tutils.$off($strokeWidth, 'click', _handles.toggleStrokeWidth)\r\n\t\tutils.$off($fontSize, 'change', _handles.toggleFontSize)\r\n\t\tutils.$off(canvas, 'mousedown', _handles.onMouseDown)\r\n\t\tutils.$off(canvas, 'click', _handles.insertTextHelper)\r\n\t\tutils.$off(document, 'click', _handles.removeTextHelper)\r\n\t\tutils.$off($saveLink, 'click', _handles.download)\r\n\t\t$textHelper && $textHelper.parentNoed.removeChild($textHelper)\r\n\t\tthis.canvas = null\r\n\t\tthis.context = null\r\n\t\tthis.history.length = 0\r\n\t}\r\n\r\n}\r\n\r\nexport default CanvasTools\n\n\n// WEBPACK FOOTER //\n// ./src/js/main.js"],"sourceRoot":""}